\begin{sequencediagram}
	\newthread{agency}{Экскурсионное бюро}

	% Первый параметр -- отступ. Что-то автоматически он не хлочет выравнивать
	\newthread{culture}{Организация культуры}

	\newthread{carrier}{Транспортная компания}  
    
	\begin{sdloop}{Цикл кэширования}
		\begin{call}{agency}{Запрос экскурсий и количества  билетов}{culture}{Расписание и количество билетов}
		\end{call}
		\begin{call}{agency}{Запрос рейсов и количества билетов}{carrier}{Расписание и количество билетов}
		\end{call}
	\end{sdloop}
		
	\begin{sdloop}{Цикл бронирования}
	
		\mess{agency}{Бронирование билетов}{culture}

		\mess{agency}{Бронирование билетов}{carrier}
    
		\begin{sdloop}{Цикл проверки состояния брони}
			\begin{call}{agency}{Запрос состояния брони}{carrier}{Состояние брони}
			\end{call}
		\end{sdloop}

        		\mess{agency}{Подтверждение брони}{culture}
		    
		\begin{sdloop}{Цикл проверки состояния брони}
			\begin{call}{agency}{Запрос состояния брони}{culture}{Состояние брони}
			\end{call}
		\end{sdloop}

        		\mess{agency}{Отзыв брони}{carrier}

	\end{sdloop}
	
\end{sequencediagram}
